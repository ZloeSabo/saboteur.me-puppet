---
classes:
  - '::mysql::server'
  - '::mysql::client'
  - '::mysql::bindings'
  - '::nginx'

#apt settings
apt::setting:
  conf-99no-recommends:
    content: 'APT::Install-Recommends "false";'
    ensure: 'file'
  conf-99no-install-suggests:
    content: 'APT::Install-Suggests "false";'
    ensure: 'file'

apt::update::frequency: 'daily'
apt::purge:
  sources.list: true
  sources.list: true
  sources.list.d: true
  preferences: true
  preferences.d: true

#mysql settings
mysql::server::package_name: 'mariadb-server'
mysql::server:package_ensure: 'latest'
mysql::server:service_name: 'mysql'
mysql::server:config_file: '/etc/my.cnf'
mysql::server:includedir: '/etc/my.cnf.d'
mysql::server:root_password: "%{hiera('root_password')}"

mysql::client::package_name: 'mariadb-client'
mysql::client::package_ensure: 'latest'

mysql::bindings::php_enable: true

#nginx settings
nginx::config::manage_repo: false
nginx::nginx_upstreams:
  phpfpm:
    ensure: present
    members:
      - '127.0.0.1:9000'

#PHP settings
php::ensure: latest
php::manage_repos: false
php::fpm: true
php::dev: true
php::composer: true
php::settings:
  'PHP/max_execution_time': '90'
  'PHP/max_input_time': '300'
  'PHP/memory_limit': '64M'
  'PHP/post_max_size': '32M'
  'PHP/upload_max_filesize': '32M'
  'Date/date.timezone': "%{hiera('timezone::timezone')}"
php::fpm::pools:
  www:
    ensure: absent
  www2:
    ensure: present
    listen: '127.0.0.1:9000'
    user: 'nginx'

profile::www_user: nginx
profile::www_group: www-data